<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://thymeleaf.org/extras/spring-security"
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
	layout:decorate="~{layouts/communityLayout}">

<th:block layout:fragment="script">
	<script th:src="@{/js/community/postView.js}"></script>
	<!-- 	<script th:src="@{https://code.jquery.com/jquery-1.11.3.js}"></script>
 -->
</th:block>

<div layout:fragment="content">
	<h3>게시글 상세보기</h3>
	<table border="1" width="300">
		<tr>
			<th th:text="${postView.title}"></th>
		</tr>
		<tr>
			<td>
				<div align="left" th:text="${postView.member.id}"></div>
				<div align="right"
					th:text="${#temporals.format(postView.postDate, 'yyyy-MM-dd HH:mm')}"></div>
				<div align="right" th:if="${postView.updateDate != null}"
					style="color: grey; font-size: 15px;"
					th:text="'(수정일자:'+${#temporals.format(postView.updateDate, 'yyyy-MM-dd HH:mm')}+')'"></div>
			</td>
		<tr>
			<td><div th:text="${postView.content}"
					style="padding: 10px; height: auto; min-height: 100px; overflow: auto;"></div></td>
		</tr>
		<tr th:each="file : ${files}" th:if="${file.originName != null}">
			<td>첨부파일: <a th:href="|./download/${file.num}|"
				th:text="${file.originName}"></a>

			</td>
		</tr>

	</table>
	<div>
		<input type="button"
			th:onclick="openModal([[${postView.num}]],[[${postView.member.id}]],[[${#authentication.name}]])"
			th:value="신고"> <a th:href="@{/community/list}"><input
			th:href="@{/community/list}" type="button" value="목록"></a>
	</div>

	<div th:if="${#authentication.name} == ${postView.member.id}">
		<a th:href="@{/community/put(num=${postView.num})}"> <input
			type="button" value="수정"></a>
		<button type="button" id="delete_confirm"
			th:onclick="deleteConfirm([[${postView.num}]])">삭제</button>
	</div>

	<div id="replyList">
		<table id="replyTable">
			<th:block th:each="reply, replyStatus: ${replyList}">
				<tr
					th:id="${reply.parentRepNum} == null ? |parentRepContentTable${reply.num}| : '' ">
					<td th:if="${reply.parentRepNum} != null"><img
						th:src="@{/img/replyreply.png}" width="20" height="20" />
					<td th:text="${reply.memberId}" />
					<td
						th:text="${#temporals.format(reply.repDate, 'yyyy-MM-dd HH:mm')}" />
					<td th:text="${reply.content}" />
					<td><button type="button" th:onclick="replyDelete([[${reply.num}]])">삭제</button>
					</td>
					<td th:if="${reply.parentRepNum} == null">
						<button type="button"
							th:onclick="|showReplyBox(replyReplyBox${reply.num})|">답글</button>
					</td>
					<!-- 	<td> 
						<img th:src="@{/img/heart.jpg}" width="20" height="20" th:onclick="heart([[${reply.num}]])"/>
						<strong th:text="${reply.heart}" style="color:red;"></strong>
					</td> -->
				</tr>

				<tr th:if="${reply.parentRepNum} == null"
					th:id="|replyReplyBox${reply.num}|" style="display: none;">
					<td><input type="text" placeholder="댓글을 입력해주세요"
						th:id="|replyReplyContent${reply.num}|"></td>
					<td><button type="button"
							th:onclick="replyReply([[${postView.num}]],[[${reply.num}]],[[${#authentication.name}]], 
							replyReplyBox[[${reply.num}]], replyReplyContent[[${reply.num}]], parentRepContentTable[[${reply.num}]])">등록</button></td>
				</tr>
			</th:block>
		</table>

	</div>
	<div class="commentBox">
		<input type="text" placeholder="댓글을 입력해주세요" id="replyContent">
		<button type="button"
			th:onclick="replySubmit([[${postView.num}]],[[${#authentication.name}]])">등록</button>
	</div>



	<!-- Modal -->
	<div class="modal" tabindex="-1" role="dialog" id="postReportModal">
		<div class="modal-dialog modal-dialog-centered modal-lg"
			role="document">
			<div class="modal-content">
				<div class="modal-header" style="align-items: baseline;">
					<h1 class="modal-title">신고하기</h1>
					<span>신고는 취소할 수 없습니다. 정말 신고하시겠습니까?</span>
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>

				<form th:action="@{/community/reportpost}" object="${reportDto}"
					method="post">
					<div class="modal-body">
						<div
							th:each="reason : ${T(com.alice.project.domain.ReportReason).values()}"
							class="form-check form-check-inline">
							<input class="form-check-input" type="radio"
								field="*{reportReason}" name="reportReason"
								th:value="${reason.name()}"> <label
								th:for="${#ids.next('reportReason')}"
								th:text="${reason.description}" class="form-check-label"></label>
						</div>
						<div>
							<input type="text" field="*{content}" name="content"
								placeholder="신고 내용을 신중히 작성해주세요" size="90">
						</div>
					</div>
					<div class="modal-footer">
						<input type="hidden" field="*{targetNum}" name="targetNum"
							th:value="${postView.member.num}"> <input type="hidden"
							field="*{postNum}" name="postNum" th:value="${postView.num}">
						<input type="submit" class="btnbtn-dark" value="신고">
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
</html>