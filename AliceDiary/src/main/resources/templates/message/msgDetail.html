<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
   layout:decorate="~{layouts/messageLayout}">
<meta id="_csrf" name="_csrf" th:content="${_csrf.token}" />
<meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}" /> 
<th:block layout:fragment="css">
   <link rel="stylesheet" th:href="@{/css/message/msgDetail.css}" />
</th:block>

<th:block layout:fragment="script">
   <script th:src="@{/js/message/msgDetail.js}"></script>
   <script th:src="@{https://code.jquery.com/jquery-3.4.1.min.js}"></script>
   
</th:block>

<div layout:fragment="content">

   <h1 th:text="${toId} + '님과의 쪽지함'" align="center"></h1>

   <div class="container-fluid">
      <th:block th:each="m : ${mdtos}">
         <div th:attr="class=${(m.user1Num != userNum and m.direction == 0) or (m.user1Num == userNum and m.direction == 1) ? 'row d-flex justify-content-start' : 'row d-flex justify-content-end'}">
            <div th:attr="class=${(m.user1Num != userNum and m.direction == 1) or (m.user1Num == userNum and m.direction == 0) ? 'col-6 bg-info' : 'col-6'}">
<!--                <p><img id="profile" th:src="${m.profile}" alt="프로필사진" th:if="${m.profile != null}" /></p> -->
               <p th:if="${m.user1Num == userNum and m.direction == 1}" th:text="${m.user2Num}"></p>
               <p th:if="${m.user2Num == userNum and m.direction == 0}" th:text="${m.user1Num}"></p>
               <p th:text="${m.content}"></p>
               <p align="right" th:text="${#temporals.format(m.sendDate, 'yyyy-MM-dd HH:mm')}"></p>            
            </div>
         </div>
      </th:block>
   </div>

<div>
   <form th:align="center" th:object="${mdto}" method="post" th:action="@{|/messagebox/${fromId}/${toId}|}">
      <textarea th:name="content" th:align="center" cols="90%" rows="5" placeholder="최대 2000자" required></textarea>
<!--       <input type="hidden" th:name="messageToId" value="${toId}" /> -->
<!--       <input type="file" th:name="originName"> -->
      <button id="sendMsgBtn" type="submit">전송</button>
   </form>
</div>
   <button th:onclick="deleteMessage([[${fromId}]], [[${toId}]])" type="button">
      <i class="fa fa-trash" aria-hidden="true"></i>쪽지함 삭제
   </button>
   <button th:onclick="'location.href=\''+ @{|/messagebox/${fromId}|} + '\''" type="button">
      <i class="fa fa-trash" aria-hidden="true"></i>목록으로 가기
   </button>   
   <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

</div>
</html>